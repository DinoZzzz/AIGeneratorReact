import React, { createContext, useContext, useEffect, useMemo, useState } from 'react';

type Language = 'hr' | 'en';

type TranslationDictionary = Record<string, string>;

const translations: Record<Language, TranslationDictionary> = {
    hr: {
        'nav.platform': 'Platforma',
        'nav.history': 'Povijest',
        'nav.examiners': 'Ispitivači',
        'nav.customers': 'Kupci',
        'nav.settings': 'Postavke',
        'nav.analytics': 'Analitika',
        'nav.help': 'Pomoć',
        'nav.signOut': 'Odjava',
        'settings.language': 'Jezik',
        'settings.languageDescription': 'Odaberite jezik sučelja',
        'language.croatian': 'Hrvatski',
        'language.english': 'Engleski',
        'history.title': 'Povijest',
        'history.certifier': 'Certifikator',
        'history.createdBy': 'Kreirao',
        'history.constructionPart': 'Dio gradilišta',
        'history.formsCount': 'Broj obrazaca',
        'history.creationTime': 'Vrijeme kreiranja',
        'history.open': 'Otvori',
        'history.remove': 'Obriši',
        'history.searchPlaceholder': 'Traži dio gradilišta...',
        'history.noDataTitle': 'Nema povijesti',
        'history.noDataDesc': 'Izvezeni izvještaji pojavit će se ovdje.',
        'history.loading': 'Učitavanje...',
        'history.page': 'Stranica',
        'history.of': 'od',
        'exportDetails.title': 'Detalji izvoza',
        'exportDetails.info': 'Informacije',
        'exportDetails.remarks': 'Napomene i odstupanja',
        'exportDetails.certifier': 'Certifikator',
        'exportDetails.createdBy': 'Kreirao',
        'exportDetails.examinationDate': 'Datum ispitivanja',
        'exportDetails.creationTime': 'Vrijeme kreiranja',
        'exportDetails.drainage': 'Drenaza',
        'exportDetails.waterRemark': 'Napomena voda',
        'exportDetails.waterDeviation': 'Odstupanje voda',
        'exportDetails.airRemark': 'Napomena zrak',
        'exportDetails.airDeviation': 'Odstupanje zrak',
        'exportDetails.includedReports': 'Uključeni izvještaji',
        'exportDetails.ordinal': 'Redni broj',
        'exportDetails.type': 'Tip',
        'exportDetails.satisfies': 'Zadovoljava',
        'exportDetails.dionica': 'Dionica',
        'exportDetails.action': 'Akcija',
        'exportDetails.edit': 'Uredi',
        'exportDetails.download': 'Preuzmi',
        'exportDetails.exportWord': 'Izvoz Word',
        'exportDetails.exportPdf': 'Izvoz PDF',
        'dashboard.welcome': 'Pozdrav',
        'dashboard.ready': 'Vaš generator je spreman.',
        'dashboard.totalCustomers': 'Ukupno kupaca',
        'dashboard.activeSites': 'Aktivna gradilišta',
        'dashboard.totalReports': 'Ukupno izvještaja',
        'dashboard.customersTable': 'Naručitelji',
        'dashboard.search': 'Pretraga...',
        'dashboard.addCustomer': 'Dodaj naručitelja',
        'dashboard.workOrder': 'Radni nalog',
        'dashboard.customer': 'Naručitelj',
        'dashboard.activeOrders': 'Aktivni radni nalozi',
        'dashboard.none': 'Nema',
        'dashboard.showMore': 'Prikaži više',
        'dashboard.showLess': 'Prikaži manje',
        'dashboard.loading': 'Učitavanje...',
        'dashboard.noCustomers': 'Nema kupaca',
        'dashboard.topCustomers': 'Naručitelji',
        'dashboard.examiners': 'Ispitivači',
        'dashboard.today': 'Danas',
        'dashboard.thisWeek': 'Ovaj tjedan',
        'common.yes': 'Da',
        'common.no': 'Ne',
        'examiners.title': 'Ispitivači',
        'examiners.subtitle': 'Upravljajte ispitivačima i njihovim akreditacijama.',
        'examiners.add': 'Dodaj ispitivača',
        'examiners.search': 'Pretraži ispitivače...',
        'examiners.fullName': 'Puno ime',
        'examiners.username': 'Korisničko ime',
        'examiners.email': 'Email',
        'examiners.accreditations': 'Akreditacije',
        'examiners.actions': 'Akcije',
        'examiners.loading': 'Učitavanje...',
        'examiners.noneFound': 'Nema pronađenih ispitivača',
        'examiners.noneDesc': 'Dodajte ispitivače kako biste upravljali njihovim akreditacijama i zadacima.',
        'examiners.accessDenied': 'Pristup odbijen',
        'examiners.accessDesc': 'Samo administratori mogu upravljati ispitivačima.',
        'examiners.admin': 'Administrator',
        'examiners.removeConfirm': 'Jeste li sigurni da želite ukloniti ovog ispitivača?',
        'examiners.dialog.new': 'Novi ispitivač',
        'examiners.dialog.edit': 'Uredi ispitivača',
        'examiners.dialog.firstName': 'Ime',
        'examiners.dialog.lastName': 'Prezime',
        'examiners.dialog.username': 'Korisničko ime',
        'examiners.dialog.title': 'Titula',
        'examiners.dialog.email': 'Email',
        'examiners.dialog.password': 'Lozinka',
        'examiners.dialog.passwordHint': '(ostavite prazno za zadržavanje postojeće)',
        'examiners.dialog.passwordPlaceholder': 'Unesite novu lozinku za promjenu',
        'examiners.dialog.admin': 'Administrator',
        'examiners.dialog.accreditations': 'Akreditacije',
        'examiners.dialog.cancel': 'Odustani',
        'examiners.dialog.save': 'Spremi',
        'examiners.dialog.saving': 'Spremanje...',
        'customers.title': 'Kupci',
        'customers.new': 'Novi kupac',
        'customers.search': 'Pretraži kupce...',
        'customers.workOrder': 'Radni nalog',
        'customers.name': 'Naziv',
        'customers.location': 'Lokacija',
        'customers.address': 'Adresa',
        'customers.actions': 'Akcije',
        'customers.loading': 'Učitavanje...',
        'customers.none': 'Nema pronađenih kupaca.',
        'customers.showing': 'Prikazujem',
        'customers.to': 'do',
        'customers.of': 'od',
        'customers.results': 'rezultata',
        'customers.prev': 'Prethodna',
        'customers.next': 'Sljedeća',
        'customers.viewConstructions': 'Pogledaj gradilišta',
        'customers.edit': 'Uredi',
        'customers.deleteConfirm': 'Brisanje kupca će ukloniti sve povezane izvještaje. Nastaviti?'
    },
    en: {
        'nav.platform': 'Platform',
        'nav.history': 'History',
        'nav.examiners': 'Examiners',
        'nav.customers': 'Customers',
        'nav.settings': 'Settings',
        'nav.analytics': 'Analytics',
        'nav.help': 'Help',
        'nav.signOut': 'Sign Out',
        'settings.language': 'Language',
        'settings.languageDescription': 'Choose the interface language',
        'language.croatian': 'Croatian',
        'language.english': 'English',
        'history.title': 'History',
        'history.certifier': 'Certifier',
        'history.createdBy': 'Created By',
        'history.constructionPart': 'Construction Part',
        'history.formsCount': 'Forms Count',
        'history.creationTime': 'Creation Time',
        'history.open': 'Open',
        'history.remove': 'Remove',
        'history.searchPlaceholder': 'Search construction part...',
        'history.noDataTitle': 'No history found',
        'history.noDataDesc': 'Exported reports and their history will appear here.',
        'history.loading': 'Loading...',
        'history.page': 'Page',
        'history.of': 'of',
        'exportDetails.title': 'Export Details',
        'exportDetails.info': 'Information',
        'exportDetails.remarks': 'Remarks & Deviations',
        'exportDetails.certifier': 'Certifier',
        'exportDetails.createdBy': 'Created By',
        'exportDetails.examinationDate': 'Examination Date',
        'exportDetails.creationTime': 'Creation Time',
        'exportDetails.drainage': 'Drainage',
        'exportDetails.waterRemark': 'Water Remark',
        'exportDetails.waterDeviation': 'Water Deviation',
        'exportDetails.airRemark': 'Air Remark',
        'exportDetails.airDeviation': 'Air Deviation',
        'exportDetails.includedReports': 'Included Reports',
        'exportDetails.ordinal': 'Ordinal',
        'exportDetails.type': 'Type',
        'exportDetails.satisfies': 'Satisfies',
        'exportDetails.dionica': 'Dionica',
        'exportDetails.action': 'Action',
        'exportDetails.edit': 'Edit',
        'exportDetails.download': 'Download',
        'exportDetails.exportWord': 'Export Word',
        'exportDetails.exportPdf': 'Export PDF',
        'dashboard.welcome': 'Hello',
        'dashboard.ready': 'Your generator is ready.',
        'dashboard.totalCustomers': 'Total Customers',
        'dashboard.activeSites': 'Active Sites',
        'dashboard.totalReports': 'Total Reports',
        'dashboard.customersTable': 'Customers',
        'dashboard.search': 'Search...',
        'dashboard.addCustomer': 'Add customer',
        'dashboard.workOrder': 'Work Order',
        'dashboard.customer': 'Customer',
        'dashboard.activeOrders': 'Active Work Orders',
        'dashboard.none': 'None',
        'dashboard.showMore': 'Show more',
        'dashboard.showLess': 'Show less',
        'dashboard.loading': 'Loading...',
        'dashboard.noCustomers': 'No customers found',
        'dashboard.topCustomers': 'Top Customers',
        'dashboard.examiners': 'Examiners',
        'dashboard.today': 'Today',
        'dashboard.thisWeek': 'This week',
        'common.yes': 'Yes',
        'common.no': 'No',
        'examiners.title': 'Examiners',
        'examiners.subtitle': 'Manage examiners and their accreditations.',
        'examiners.add': 'Add Examiner',
        'examiners.search': 'Search examiners...',
        'examiners.fullName': 'Full Name',
        'examiners.username': 'Username',
        'examiners.email': 'Email',
        'examiners.accreditations': 'Accreditations',
        'examiners.actions': 'Actions',
        'examiners.loading': 'Loading...',
        'examiners.noneFound': 'No examiners found',
        'examiners.noneDesc': 'Add examiners to manage their accreditations and assignments.',
        'examiners.accessDenied': 'Access Denied',
        'examiners.accessDesc': 'Only administrators can manage examiners.',
        'examiners.admin': 'Administrator',
        'examiners.removeConfirm': 'Are you sure you want to remove this examiner?',
        'examiners.dialog.new': 'New Examiner',
        'examiners.dialog.edit': 'Edit Examiner',
        'examiners.dialog.firstName': 'First Name',
        'examiners.dialog.lastName': 'Last Name',
        'examiners.dialog.username': 'Username',
        'examiners.dialog.title': 'Title',
        'examiners.dialog.email': 'Email',
        'examiners.dialog.password': 'Password',
        'examiners.dialog.passwordHint': '(leave empty to keep current)',
        'examiners.dialog.passwordPlaceholder': 'Enter new password to change',
        'examiners.dialog.admin': 'Administrator',
        'examiners.dialog.accreditations': 'Accreditations',
        'examiners.dialog.cancel': 'Cancel',
        'examiners.dialog.save': 'Save',
        'examiners.dialog.saving': 'Saving...',
        'customers.title': 'Customers',
        'customers.new': 'New Customer',
        'customers.search': 'Search customers...',
        'customers.workOrder': 'Work Order',
        'customers.name': 'Name',
        'customers.location': 'Location',
        'customers.address': 'Address',
        'customers.actions': 'Actions',
        'customers.loading': 'Loading...',
        'customers.none': 'No customers found.',
        'customers.showing': 'Showing',
        'customers.to': 'to',
        'customers.of': 'of',
        'customers.results': 'results',
        'customers.prev': 'Previous',
        'customers.next': 'Next',
        'customers.viewConstructions': 'View Constructions',
        'customers.edit': 'Edit',
        'customers.deleteConfirm': 'Removing this customer will also remove all related reports. Continue?'
    }
};

// Extend customer translations (clean ASCII overrides)
Object.assign(translations.hr, {
    'customers.postalCode': 'Poštanski broj',
    'customers.save': 'Spremi',
    'customers.loadingForm': 'Učitavanje...',
    'customers.newTitle': 'Novi kupac',
    'customers.editTitle': 'Uredi kupca',
    'customers.placeholderWork': 'npr. 2023-001',
    'customers.placeholderName': 'Naziv kupca',
    'customers.placeholderLocation': 'Grad / Regija',
    'customers.placeholderAddress': 'Ulica i broj',
    'customers.placeholderPostal': 'Poštanski broj',
    'customers.deleteConfirm': 'Brisanje kupca će ukloniti sve povezane izvještaje. Nastaviti?',
    'customers.search': 'Pretraži kupce...',
    'customers.viewConstructions': 'Pogledaj gradilišta',
    'customers.next': 'Sljedeća',
    'constructions.title': 'Gradilišta',
    'constructions.for': 'za',
    'constructions.new': 'Novo gradilište',
    'constructions.search': 'Pretraži gradilišta...',
    'constructions.workOrder': 'Radni nalog',
    'constructions.name': 'Naziv',
    'constructions.location': 'Lokacija',
    'constructions.actions': 'Akcije',
    'constructions.viewReports': 'Pogledaj izvještaje',
    'constructions.edit': 'Uredi',
    'constructions.delete': 'Obriši',
    'constructions.deleteConfirm': 'Jeste li sigurni da želite obrisati ovo gradilište? Ovo će obrisati sve povezane izvještaje.',
    'constructions.none': 'Nema gradilišta.'
});

// Final clean overrides and additions
Object.assign(translations.hr, {
    'customers.postalCode': 'Poštanski broj',
    'customers.deleteConfirm': 'Brisanje kupca će ukloniti sve povezane izvještaje. Nastaviti?',
    'customers.search': 'Pretraži kupce...',
    'customers.viewConstructions': 'Pogledaj gradilišta',
    'customers.next': 'Sljedeća',
    'constructions.title': 'Gradilišta',
    'constructions.new': 'Novo gradilište',
    'constructions.for': 'za',
    'constructions.search': 'Pretraži gradilišta...',
    'constructions.workOrder': 'Radni nalog',
    'constructions.name': 'Naziv',
    'constructions.location': 'Lokacija',
    'constructions.actions': 'Akcije',
    'constructions.viewReports': 'Pogledaj izvještaje',
    'constructions.edit': 'Uredi',
    'constructions.delete': 'Obriši',
    'constructions.deleteConfirm': 'Jeste li sigurni da želite obrisati ovo gradilište? Ovo će obrisati sve povezane izvještaje.',
    'constructions.none': 'Nema gradilišta.',
    'constructions.loading': 'Učitavanje...',
    'constructions.save': 'Spremi',
    'constructions.newTitle': 'Novo gradilište',
    'constructions.editTitle': 'Uredi gradilište',
    'constructions.placeholderWork': 'npr. 2023-001-A',
    'constructions.placeholderName': 'Naziv gradilišta',
    'constructions.placeholderLocation': 'Lokacija gradilišta',
    'reports.title': 'Izvješća',
    'reports.deleteSelected': 'Obriši odabrano',
    'reports.newReport': 'Novi zapis',
    'reports.generateReports': 'Generiraj izvješća',
    'reports.exportSelected': 'Izvoz odabranih',
    'reports.exportAll': 'Izvoz svih',
    'reports.date': 'Datum',
    'reports.type': 'Tip',
    'reports.dionica': 'Dionica',
    'reports.draft': 'Skica',
    'reports.status': 'Status',
    'reports.actions': 'Akcije',
    'reports.exportPdf': 'Izvoz PDF',
    'reports.edit': 'Uredi',
    'reports.delete': 'Obriši',
    'reports.noData': 'Nema izvješća za ovo gradilište.',
    'reports.satisfies': 'Zadovoljava',
    'reports.failed': 'Ne zadovoljava'
});

Object.assign(translations.en, {
    'constructions.title': 'Construction Sites',
    'constructions.new': 'New Construction',
    'constructions.for': 'for',
    'constructions.search': 'Search constructions...',
    'constructions.workOrder': 'Work Order',
    'constructions.name': 'Name',
    'constructions.location': 'Location',
    'constructions.actions': 'Actions',
    'constructions.viewReports': 'View Reports',
    'constructions.edit': 'Edit',
    'constructions.delete': 'Delete',
    'constructions.deleteConfirm': 'Are you sure you want to delete this construction site? This will also delete all associated reports.',
    'constructions.none': 'No construction sites found.',
    'constructions.loading': 'Loading...',
    'constructions.save': 'Save',
    'constructions.newTitle': 'New Construction',
    'constructions.editTitle': 'Edit Construction',
    'constructions.placeholderWork': 'e.g., 2023-001-A',
    'constructions.placeholderName': 'Construction Site Name',
    'constructions.placeholderLocation': 'Site Location',
    'reports.title': 'Reports',
    'reports.deleteSelected': 'Delete Selected',
    'reports.newReport': 'New Report',
    'reports.generateReports': 'Generate Reports',
    'reports.exportSelected': 'Export Selected',
    'reports.exportAll': 'Export All',
    'reports.date': 'Date',
    'reports.type': 'Type',
    'reports.dionica': 'Dionica',
    'reports.draft': 'Draft',
    'reports.status': 'Status',
    'reports.actions': 'Actions',
    'reports.exportPdf': 'Export PDF',
    'reports.edit': 'Edit',
    'reports.delete': 'Delete',
    'reports.noData': 'No reports found for this construction site.',
    'reports.satisfies': 'Satisfies',
    'reports.failed': 'Failed'
});

Object.assign(translations.en, {
    'customers.postalCode': 'Postal Code',
    'customers.save': 'Save',
    'customers.loadingForm': 'Loading...',
    'customers.newTitle': 'New Customer',
    'customers.editTitle': 'Edit Customer',
    'customers.placeholderWork': 'e.g., 2023-001',
    'customers.placeholderName': 'Customer Name',
    'customers.placeholderLocation': 'City / Region',
    'customers.placeholderAddress': 'Street Address',
    'customers.placeholderPostal': 'Postal Code',
    'customers.deleteConfirm': 'Removing this customer will also remove all related reports. Continue?',
    'customers.search': 'Search customers...',
    'customers.viewConstructions': 'View Constructions',
    'customers.next': 'Next',
    'constructions.title': 'Construction Sites',
    'constructions.for': 'for',
    'constructions.new': 'New Construction',
    'constructions.search': 'Search constructions...',
    'constructions.workOrder': 'Work Order',
    'constructions.name': 'Name',
    'constructions.location': 'Location',
    'constructions.actions': 'Actions',
    'constructions.viewReports': 'View Reports',
    'constructions.edit': 'Edit',
    'constructions.delete': 'Delete',
    'constructions.deleteConfirm': 'Are you sure you want to delete this construction site? This will also delete all associated reports.',
    'constructions.none': 'No construction sites found.'
});

// Clean overrides for constructions (HR/EN)
Object.assign(translations.hr, {
    'constructions.loading': 'Učitavanje...',
    'constructions.save': 'Spremi',
    'constructions.newTitle': 'Novo gradilište',
    'constructions.editTitle': 'Uredi gradilište',
    'constructions.placeholderWork': 'npr. 2023-001-A',
    'constructions.placeholderName': 'Naziv gradilišta',
    'constructions.placeholderLocation': 'Lokacija gradilišta'
});

Object.assign(translations.en, {
    'constructions.loading': 'Loading...',
    'constructions.save': 'Save',
    'constructions.newTitle': 'New Construction',
    'constructions.editTitle': 'Edit Construction',
    'constructions.placeholderWork': 'e.g., 2023-001-A',
    'constructions.placeholderName': 'Construction Site Name',
    'constructions.placeholderLocation': 'Site Location'
});

interface LanguageContextValue {
    language: Language;
    setLanguage: (lang: Language) => void;
    t: (key: string) => string;
}

const LanguageContext = createContext<LanguageContextValue | undefined>(undefined);

export const LanguageProvider = ({ children }: { children: React.ReactNode }) => {
    const [language, setLanguageState] = useState<Language>(() => {
        const stored = localStorage.getItem('language') as Language | null;
        return stored || 'hr';
    });

    useEffect(() => {
        localStorage.setItem('language', language);
        document.documentElement.lang = language;
    }, [language]);

    const setLanguage = (lang: Language) => setLanguageState(lang);

    const t = (key: string) => translations[language][key] || translations.hr[key] || key;

    const value = useMemo(() => ({ language, setLanguage, t }), [language]);

    return (
        <LanguageContext.Provider value={value}>
            {children}
        </LanguageContext.Provider>
    );
};

export const useLanguage = () => {
    const ctx = useContext(LanguageContext);
    if (!ctx) throw new Error('useLanguage must be used within LanguageProvider');
    return ctx;
};
